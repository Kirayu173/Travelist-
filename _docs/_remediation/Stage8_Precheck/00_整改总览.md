# Stage-8 准入整改档案（总览）

生成日期：2025-12-13  
范围：进入 Stage-8（Deep Planning/Async Tasks）前的工程化整改、质量验证与证据留档。

## 整改项清单（状态）
| ID | 优先级 | 整改项 | 目标 | 状态 |
| --- | --- | --- | --- | --- |
| P0-1 | P0 | CI 可运行（PostGIS） | GitHub Actions 能稳定跑 `ruff/black/pytest` | 已完成 |
| P0-2 | P0 | Stage-7 冻结/可追溯 | README 阶段对齐、形成可回溯里程碑 | 已完成（未自动打 tag） |
| P1-1 | P1 | 目的地中心点真实化 | 用 geocode 替代伪中心点，提升候选质量 | 已完成（可配置回退） |
| P1-2 | P1 | 指标持久化 | 支持多实例/重启后统计不丢（Redis 可选） | 已完成（可配置） |
| P2-1 | P2 | 数据治理：逆地理增强 | 形成可重复数据增强流程与验收标准 | 已完成 |
| P2-2 | P2 | E2E 冒烟 | 提供可重复冒烟脚本，验证 plan + admin summary | 已完成 |
| P2-3 | P2 | Admin SQL 安全加固 | 默认关闭、超时/行数限制、审计日志 | 已完成 |

## 证据材料（文件）
- CI：`.github/workflows/ci.yml`
- README 阶段对齐：`README.md`
- Geocode：`backend/app/services/geocode_service.py`、`backend/app/services/fast_planner.py`、`backend/app/core/settings.py`、`.env.example`
- PlanMetrics（Redis 可选）：`backend/app/services/plan_metrics.py`、`backend/app/core/settings.py`、`.env.example`
- Admin SQL 加固：`backend/app/api/admin.py`、`backend/app/admin/templates/db_schema.html`、`backend/tests/conftest.py`
- 数据治理文档：`_docs/data/poi_reverse_geocode_enrichment.md`
- 冒烟脚本：`scripts/smoke_stage7.py`

## 验证与检查记录
详见：`_docs/_remediation/Stage8_Precheck/验收报告.md`

